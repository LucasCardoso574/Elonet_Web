---
const items = [
  { year: "1997", text: "Fundação da empresa e início das operações no setor financeiro habitacional." },
  { year: "2005", text: "Expansão da atuação e consolidação da presença nacional." },
  { year: "2010", text: "Crescimento do portfólio e fortalecimento dos processos internos." },
  { year: "2015", text: "Modernização tecnológica e evolução das soluções digitais." },
  { year: "2020", text: "Consolidação no mercado com foco em eficiência e escala." },
  { year: "2025", text: "Atuação sólida orientada por inovação, qualidade e segurança." }
];
---

<section class="history">
  <header class="header">
    <h2>Nossa História</h2>

    <div class="nav">
      <button class="btn" id="prev" type="button" aria-label="Anterior">‹</button>
      <button class="btn" id="next" type="button" aria-label="Próximo">›</button>
    </div>
  </header>

  <div class="viewport" id="viewport" tabindex="0" aria-label="Carrossel da linha do tempo">
    <div class="track" id="track">
      <div class="rail" aria-hidden="true">
        <span class="rail-line"></span>
        {items.map(() => <span class="rail-dot"></span>)}
      </div>

      <div class="cards">
        {items.map((item) => (
          <article class="card">
            <div class="year">{item.year}</div>
            <p class="text">{item.text}</p>
          </article>
        ))}
      </div>
    </div>
  </div>
</section>

<script>
  (() => {
    const viewportEl = document.getElementById("viewport");
    const prevEl = document.getElementById("prev");
    const nextEl = document.getElementById("next");
    const trackEl = document.getElementById("track");

    
    if (!(viewportEl instanceof HTMLElement)) return;
    if (!(prevEl instanceof HTMLButtonElement)) return;
    if (!(nextEl instanceof HTMLButtonElement)) return;
    if (!(trackEl instanceof HTMLElement)) return;

    const viewport = viewportEl;
    const prev = prevEl;
    const next = nextEl;
    const track = trackEl;

   /** @param {1 | -1} dir */
function scrollByOne(dir: 1 | -1) {
  const firstCard = track.querySelector(".card");
  const cards = track.querySelector(".cards");
  if (!(firstCard instanceof HTMLElement)) return;
  if (!(cards instanceof HTMLElement)) return;


      const styles = getComputedStyle(cards);
      const gap = parseFloat(styles.columnGap || styles.gap || "0");
      const step = firstCard.getBoundingClientRect().width + gap;

      viewport.scrollBy({ left: dir * step, behavior: "smooth" });
    }

    prev.addEventListener("click", () => scrollByOne(-1));
    next.addEventListener("click", () => scrollByOne(1));

    viewport.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft") scrollByOne(-1);
      if (e.key === "ArrowRight") scrollByOne(1);
    });
  })();
</script>

<style>
:root{
  --brand: #0B6B1D;
  --text: #0b1220;
  --muted: #475569;
  --line: rgba(11, 107, 29, 0.45);

  --dot: 14px;
  --rail-h: 40px;

  --card-w: 280px;
  --gap: 4rem;
}

.history{
  padding: 5rem 1rem;
  background: #fff;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
}

.header{
  max-width: 1200px;
  margin: 0 auto 2.25rem auto;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 1rem;
}

.header h2{
  margin: 0;
  font-size: 2.2rem;
  font-weight: 600;
  letter-spacing: -0.02em;
  color: var(--text);
}

.nav{ display:flex; gap:.75rem; }

.btn{
  width: 44px;
  height: 44px;
  border-radius: 999px;
  border: 1px solid rgba(2,6,23,0.10);
  background: rgba(2,6,23,0.05);
  color: rgba(2,6,23,0.65);
  font-size: 28px;
  cursor:pointer;
  transition: 150ms ease;
}
.btn:hover{ background: rgba(2,6,23,0.08); color: rgba(2,6,23,0.9); }

.viewport{
  max-width: 1200px;
  margin: 0 auto;

  overflow-x:auto;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;

  padding: 0 18px 18px 18px;
}
.viewport::-webkit-scrollbar{ display:none; }


.track{
  display: grid;
  gap: 12px;
  width: max-content; 
}


.rail,
.cards{
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: var(--card-w);
  column-gap: var(--gap);
  width: max-content;
}


.rail{
  position: relative;
  height: var(--rail-h);
  align-items: center;
  margin-bottom: 10px;
}

.rail-line{
  position: absolute;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--line);
  top: 50%;
  transform: translateY(-50%);
  z-index: 0;
}

.rail-dot{
  width: var(--dot);
  height: var(--dot);
  border-radius: 999px;
  background: var(--brand);
  justify-self: center;
  z-index: 1;
}


.card{
  width: var(--card-w);
  scroll-snap-align: start;
}

.year{
  font-size: 1.55rem;
  font-weight: 600;
  color: var(--text);
}

.text{
  margin: .55rem 0 0 0;
  font-size: 1rem;
  line-height: 1.55;
  color: var(--muted);
  max-width: 26ch;
}

@media (max-width: 768px){
  :root{
    --card-w: 240px;
    --gap: 2.5rem;
    --dot: 12px;
  }
  .header h2{ font-size: 1.85rem; }
}
</style>
